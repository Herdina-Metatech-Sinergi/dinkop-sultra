<?php
 namespace App\Http\Controllers; use App\Filament\Pages\JurnalUmum; use App\Models\AnggotaKoperasi; use App\Models\JurnalUmum as ModelsJurnalUmum; use App\Models\KonfigurasiCOA; use App\Models\User; use Carbon\Carbon; use Illuminate\Foundation\Auth\Access\AuthorizesRequests; use Illuminate\Foundation\Validation\ValidatesRequests; use Illuminate\Routing\Controller as BaseController; class Controller extends BaseController { use AuthorizesRequests, ValidatesRequests; static function rupiah($angka) { $hasil_rupiah = "\122\160" . number_format($angka, 0, "\x2c", "\x2e") . "\x2c\55"; return $hasil_rupiah; } public function jurnal_umum($konfigurasi_coa_id, $nominal, $anggota_id, $jurnal_kode = null, $deskripsi = null, $tanggal, $hapus = null, $identitas_koperasi_id = null) { $kon = KonfigurasiCOA::where("\x6e\x61\x6d\x61", $konfigurasi_coa_id)->get(); $car = Carbon::now()->isoFormat("\131\x59\131\x59\115\115\104\x44"); if ($tanggal) { $date = $tanggal; } else { $date = date("\x59\x2d\x6d\55\144\40\110\x3a\151\72\163"); } $anggota = AnggotaKoperasi::where("\x69\x64", $anggota_id)->first(); if ($identitas_koperasi_id == null) { $identitas_koperasi_id = $anggota->identitas_koperasi_id; } $jurnal = date("\131\155\x64\110\151\x73", strtotime($date)) . "\x23" . ($kon[0]->id ?? "\60") . "\43" . $identitas_koperasi_id . "\43" . (auth()->user()->id ?? 1) . "\43" . ($anggota->id ?? 0); if ($hapus) { ModelsJurnalUmum::where("\152\x75\x72\156\x61\154", $jurnal)->delete(); return true; } foreach ($kon as $key) { $nom = $nominal; if ($key->persen) { $nom = $nominal * ($key->persen / 100); } ModelsJurnalUmum::updateOrCreate(array("\x6a\x75\162\x6e\x61\154" => $jurnal_kode ?? $jurnal, "\141\x6b\x75\156" => $key->akun), array("\164\x61\156\147\147\x61\x6c" => $date, "\x64\x65\x73\x6b\x72\151\160\x73\151" => $konfigurasi_coa_id . "\40" . @$deskripsi, "\141\153\x75\x6e" => $key->akun, "\x64\x5f\153" => $key->d_k, "\x6e\157\x6d\151\x6e\x61\x6c" => $nom, "\x75\163\145\162\137\151\x64" => auth()->user()->id ?? 1, "\152\165\162\x6e\141\154" => $jurnal_kode ?? $jurnal, "\151\144\x65\x6e\164\151\x74\x61\x73\137\153\x6f\160\x65\162\141\163\x69\x5f\151\144" => $identitas_koperasi_id)); } return true; } }
